# Security Analysis: F106 - Payment Data Protection

| Section | Details |
| :--- | :--- |
| **Name (Feature ID/s)** | Jungwook Van (F106) |
| **Main Security Concerns** | - **Data Leakage of Sensitive Information**: API responses exposing sensitive payment data, such as full credit card numbers, internal transaction IDs from the payment gateway, or other personally identifiable financial information.<br>- **Unauthorized Access to Payment History**: A user being able to view the payment history of another user, or a non-manager employee accessing the complete payment records of all customers.<br>- **Insecure Storage**: Storing sensitive payment details (like credit card numbers) directly in the application's database. |
| **Security Measures Implemented** | - **DTOs for Data Sanitization**: The API uses `PaymentDto` to return only non-sensitive information to the client (e.g., payment status, amount, and a masked payment method identifier). Sensitive details from the payment gateway are never exposed.<br>- **Authorization on Data Access**: The endpoint to fetch payment history (`/api/payments`) is secured. A regular user can only retrieve their own payment history, enforced by checking the authenticated principal's ID against the requested data. Managers have broader access, which is protected by role-based security (`@PreAuthorize("hasRole('MANAGER')")`).<br>- **No Storage of Sensitive Payment Data**: The system does not store raw credit card numbers or CVVs. It only stores a reference token or transaction ID provided by the external payment gateway, adhering to PCI DSS compliance principles. |
| **Relevant Non-Functional or Design Requirements (if applicable)** | - **NFR-DATA-02: Data Privacy**: "The system must protect user privacy by not exposing sensitive personal or financial data through API endpoints."<br>- **DEF-API-03: DTO Usage**: "Data Transfer Objects must be used to control the data exposed in API responses, filtering out sensitive or internal-only fields." |
| **Impact on Overall Security** | This approach significantly reduces the risk associated with handling financial data. By not storing sensitive payment information and by strictly controlling access to payment history, the application minimizes its attack surface. If a database breach were to occur, no credit card numbers would be compromised. This protects both the customer and the business from fraud and data theft. |
